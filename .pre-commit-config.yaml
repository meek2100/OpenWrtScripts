# OpenWrt-focused pre-commit config
# Targeted at POSIX/sh scripts for OpenWrt (ash shell) environment.
exclude: ^(\.[^/]*cache/.*|demo/.*|debug/.*)$
repos:
  # 1. Basic File Hygiene
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
        name: Trim Trailing Whitespace
      - id: end-of-file-fixer
        name: Fix End of File
      - id: check-executables-have-shebangs
        name: Check Shebangs on Executables
      - id: check-shebang-scripts-are-executable
        name: Ensure Scripts are Executable
      - id: mixed-line-ending
        name: Fix Mixed Line Endings (LF)
        args: [--fix=lf]
      - id: check-merge-conflict
        name: Check Merge Conflicts
      - id: check-case-conflict
        name: Check Filename Case Conflicts

  # 2. Shell Formatting (shfmt)
  - repo: https://github.com/scop/pre-commit-shfmt
    rev: v3.12.0-2
    hooks:
      - id: shfmt
        name: Format Shell Scripts (shfmt)
        # -ln posix : Enforce POSIX/ash syntax (CRITICAL for OpenWrt)
        # -i 2      : Indent with 2 spaces
        # -ci       : Indent switch cases
        # -sr       : Redirect operators will be followed by a space
        # -s        : Simplify the code
        args: ["-ln", "posix", "-i", "2", "-ci", "-sr", "-s"]

  # 3. Shell Linting (ShellCheck)
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.11.0.1
    hooks:
      - id: shellcheck
        name: Lint Shell Scripts (ShellCheck)
        files: \.(sh|bats|bash)$
        # Enforce POSIX 'sh' compliance
        args: ["--shell", "sh"]

  # 4. Markdown Formatting (mdformat)
  #  - Wraps text at 80 chars
  #  - Uses GitHub Flavored Markdown (gfm)
  #  - No external config file needed
  - repo: https://github.com/executablebooks/mdformat
    rev: 1.0.0
    hooks:
      - id: mdformat
        name: Format Markdown
        additional_dependencies:
          - mdformat-gfm
          - mdformat-toc
        # Inline config: wrap at 80 cols, number lists
        args: ["--wrap", "80", "--number"]
